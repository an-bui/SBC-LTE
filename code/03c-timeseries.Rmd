---
title: "timeseries"
author: "An Bui"
date: "1/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 0. set up
```{r}
source(here::here("code", "00-set_up.R"))

library(patchwork)
```

# 1. Kelp biomass

## Data frame

`kelp_fronds` is created in the set up script - each row is a part of a transect with a unique `sample_ID`. Observations with `-99999` have also been filtered out.

## More wrangling

Data frames:  
- `delta_fronds`: calculates difference in frond density between control and removal plots (control - annual, and control - continual)  
- `control_fronds`: kelp fronds from control plots only  
- `total_fronds`: kelp fronds from treatment + control plots

```{r}
delta_fronds <- kelp_fronds %>% 
  group_by(site, year, month, season, treatment, date) %>% 
  summarize(total_fronds = sum(fronds)) %>% 
  ungroup() %>% 
  # add new column with start/during/after because not preserved by group_by
  mutate(exp_dates = case_when(
    site == "NAPL" & date == napl_start_date ~ "start",
    site == "NAPL" & date > napl_after_date ~ "after",
    site == "MOHK" & date == mohk_start_date ~ "start",
    site == "MOHK" & date > mohk_after_date ~ "after",
    site == "AQUE" & date == aque_start_date ~ "start",
    site == "AQUE" & date > aque_after_date ~ "after",
    site == "CARP" & date == carp_start_date ~ "start",
    site == "CARP" & date > carp_after_date ~ "after",
    site == "IVEE" & date == ivee_start_date ~ "start",
    site == "IVEE" & date > ivee_after_date ~ "after",
    TRUE ~ "during"
  ),
  exp_dates = factor(exp_dates, levels = c("start", "during", "after"))) %>% 
  filter(total_fronds > -1) %>% 
  pivot_wider(names_from = treatment, values_from = total_fronds) %>% 
  mutate(delta_annual = ANNUAL - CONTROL,
         delta_continual = CONTINUAL - CONTROL) 

# just control
control_fronds <- kelp_fronds %>% 
  filter(treatment == "CONTROL") %>% 
  group_by(site, year, month, season, date) %>% 
  summarize(total_fronds = sum(fronds)) %>% 
  ungroup() %>% 
  # add new column with start/during/after
  mutate(exp_dates = case_when(
    site == "NAPL" & date == napl_start_date ~ "start",
    site == "NAPL" & date > napl_after_date ~ "after",
    site == "MOHK" & date == mohk_start_date ~ "start",
    site == "MOHK" & date > mohk_after_date ~ "after",
    site == "AQUE" & date == aque_start_date ~ "start",
    site == "AQUE" & date > aque_after_date ~ "after",
    site == "CARP" & date == carp_start_date ~ "start",
    site == "CARP" & date > carp_after_date ~ "after",
    site == "IVEE" & date == ivee_start_date ~ "start",
    site == "IVEE" & date > ivee_after_date ~ "after",
    TRUE ~ "during"
  ),
  exp_dates = factor(exp_dates, levels = c("start", "during", "after"))) %>% 
  filter(total_fronds > -1)

# total fronds
total_fronds <- kelp_fronds %>% 
  group_by(site, year, month, treatment, season, date) %>% 
  summarize(total_fronds = sum(fronds)) %>% 
  ungroup() %>% 
  # add new column with start/during/after
  mutate(exp_dates = case_when(
    site == "NAPL" & date == napl_start_date ~ "start",
    site == "NAPL" & date > napl_after_date ~ "after",
    site == "MOHK" & date == mohk_start_date ~ "start",
    site == "MOHK" & date > mohk_after_date ~ "after",
    site == "AQUE" & date == aque_start_date ~ "start",
    site == "AQUE" & date > aque_after_date ~ "after",
    site == "CARP" & date == carp_start_date ~ "start",
    site == "CARP" & date > carp_after_date ~ "after",
    site == "IVEE" & date == ivee_start_date ~ "start",
    site == "IVEE" & date > ivee_after_date ~ "after",
    TRUE ~ "during"
  ),
  exp_dates = factor(exp_dates, levels = c("start", "during", "after"))) %>% 
  filter(total_fronds > -1) 
```

## Plotting

### Total kelp frond timeseries

This creates a plot where kelp frond density timeseries are plotted for each LTE site with control in open circles, annual in green circles, and continual in blue triangles. There is a `ggsave()` command at the end - **remember to change the date in the file name before saving**.

```{r}
total_frond_timeseries_fxn <- function(site_choice) {
  after_date <- if(site_choice == "AQUE") {
    aque_after_date
  } else if(site_choice == "NAPL") {
    napl_after_date
  } else if(site_choice == "CARP") {
    carp_after_date
  } else if(site_choice == "IVEE") {
    ivee_after_date
  } else if(site_choice == "MOHK") {
    mohk_after_date
  }
  
  ggplot(data = total_fronds %>% filter(site == site_choice),
         aes(x = date, y = total_fronds, color = treatment, shape = treatment)) +
    scale_x_date(limits = c(aque_start_date, as.Date("2021-10-02"))) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
    geom_point(size = 2) +
    geom_line() +
    geom_vline(xintercept = after_date, show.legend = NA) +
    scale_color_manual(name = NULL,
                       breaks = c("ANNUAL", "CONTINUAL", "CONTROL"),
                       values = c("ANNUAL" = annual_col, "CONTINUAL" = continual_col, "CONTROL" = "grey")) +
    scale_shape_manual(name = NULL,
                       breaks = c("ANNUAL", "CONTINUAL", "CONTROL"),
                       values = c("ANNUAL" = annual_shape, "CONTINUAL" = continual_shape, "CONTROL" = 21))  +
    theme_bw() + 
    labs(title = site_choice,
         x = " ",
         y = " ")
}

aque_total_frond_timeseries <- total_frond_timeseries_fxn("AQUE")
mohk_total_frond_timeseries <- total_frond_timeseries_fxn("MOHK")
carp_total_frond_timeseries <- total_frond_timeseries_fxn("CARP")
ivee_total_frond_timeseries <- ggplot(data = total_fronds %>% filter(site == "IVEE"),
         aes(x = date, y = total_fronds, color = treatment, shape = treatment)) +
  scale_x_date(limits = c(aque_start_date, as.Date("2021-10-02"))) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  geom_point(size = 2) +
  geom_line() +
  geom_vline(xintercept = ivee_after_date, show.legend = NA) +
  scale_color_manual(name = NULL,
                       breaks = c("ANNUAL", "CONTINUAL", "CONTROL"),
                       values = c("ANNUAL" = annual_col, "CONTINUAL" = continual_col, "CONTROL" = "grey")) +
    scale_shape_manual(name = NULL,
                       breaks = c("ANNUAL", "CONTINUAL", "CONTROL"),
                       values = c("ANNUAL" = annual_shape, "CONTINUAL" = continual_shape, "CONTROL" = 21)) +
  theme_bw() + 
  theme(legend.position = "none") +
  labs(title = "IVEE",
       x = "Sampling date",
       y = " ")
napl_total_frond_timeseries <- total_frond_timeseries_fxn("NAPL")

aque_total_frond_timeseries
mohk_total_frond_timeseries
ivee_total_frond_timeseries
napl_total_frond_timeseries
carp_total_frond_timeseries

# y-axis label for patchwork side eye emoji
yaxislabel <- ggplot(data.frame(l = "kelp frond density", x = 1, y = 1)) +
      geom_text(aes(x, y, label = l), angle = 90) + 
      theme_void() +
      coord_cartesian(clip = "off")

plots_together <- yaxislabel + (aque_total_frond_timeseries / mohk_total_frond_timeseries / napl_total_frond_timeseries / ivee_total_frond_timeseries / carp_total_frond_timeseries) +
  plot_layout(guides = "collect", widths = c(1, 25)) &
  theme(legend.position = "bottom")

plots_together

# ggsave(here::here("figures", "kelp_total_frond_ts-20211012.jpg"), plots_together, height = 9, width = 5, dpi = 200)
```

### Delta kelp frond timeseries

This creates a plot where delta kelp frond density (difference between control and removal density) timeseries are plotted for each LTE site with annual in green circles and continual in blue circles. This was supposed to be a recreation of the plots that Adrian sent a long time ago. There is a `ggsave()` command at the end - **remember to change the date in the file name before saving**.

```{r}
kelp_timeseries_fxn <- function(site_choice) {
  after_date <- if(site_choice == "AQUE") {
    aque_after_date
  } else if(site_choice == "NAPL") {
    napl_after_date
  } else if(site_choice == "CARP") {
    carp_after_date
  } else if(site_choice == "IVEE") {
    ivee_after_date
  } else if(site_choice == "MOHK") {
    mohk_after_date
  }
  
  
  
  ggplot() +
    scale_x_date(limits = c(aque_start_date, as.Date("2021-10-02"))) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
    geom_point(data = delta_fronds %>% filter(site == site_choice & delta_annual != "NA"), 
               aes(x = date, y = delta_annual, color = "Annual")) +
    geom_line(data = delta_fronds %>% filter(site == site_choice & delta_annual != "NA"),
              aes(x = date, y = delta_annual, color = "Annual")) +
    geom_point(data = delta_fronds %>% filter(site == site_choice & delta_continual != "NA"), 
               aes(x = date, y = delta_continual, color = "Continual")) +
    geom_line(data = delta_fronds %>% filter(site == site_choice & delta_continual != "NA"),
              aes(x = date, y = delta_continual, color = "Continual")) +
    geom_vline(xintercept = after_date, show.legend = NA) +
    scale_color_manual(name = NULL,
                       breaks = c("Annual", "Continual"),
                       values = c("Annual" = "green", "Continual" = "blue")) +
    theme_bw() + 
    labs(title = site_choice,
         x = " ",
         y = " ")
}

aque_kelp_timeseries <- kelp_timeseries_fxn("AQUE")
mohk_kelp_timeseries <- kelp_timeseries_fxn("MOHK")
carp_kelp_timeseries <- kelp_timeseries_fxn("CARP")
ivee_kelp_timeseries <- ggplot() +
  scale_x_date(limits = c(aque_start_date, as.Date("2020-06-01"))) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  geom_point(data = delta_fronds %>% filter(site == "IVEE" & delta_annual != "NA"), 
             aes(x = date, y = delta_annual), color = "green") +
  geom_line(data = delta_fronds %>% filter(site == "IVEE" & delta_annual != "NA"),
            aes(x = date, y = delta_annual), color = "green") +
  geom_vline(xintercept = ivee_after_date, show.legend = NA) +
  theme_bw() + 
  labs(title = "IVEE",
       x = "Sampling date",
       y = " ")
napl_kelp_timeseries <- kelp_timeseries_fxn("NAPL")

aque_kelp_timeseries
mohk_kelp_timeseries
ivee_kelp_timeseries
napl_kelp_timeseries
carp_kelp_timeseries

# y-axis label for patchwork side eye emoji
yaxislabel <- ggplot(data.frame(l = "kelp fronds (removal - control)", x = 1, y = 1)) +
      geom_text(aes(x, y, label = l), angle = 90) + 
      theme_void() +
      coord_cartesian(clip = "off")

plots_together <- yaxislabel + (aque_kelp_timeseries / mohk_kelp_timeseries / napl_kelp_timeseries / ivee_kelp_timeseries / carp_kelp_timeseries) +
  plot_layout(guides = "collect", widths = c(1, 25)) &
  theme(legend.position = "bottom")

plots_together

# ggsave(here::here("figures", "kelp_frond_ts-20220201.jpg"), plots_together, height = 9, width = 5, dpi = 200)
```

## Model selection for delta frond density

Using function from the Thibault script below. Made edits to not print out results in the quartz viewer.

```{r}
ProgressiveChangeBACIPS<-function(control, impact, time.true, time.model) 
{
	### STEP 2 - Calculate the delta at each sampling date
	delta <- impact - control
	
	# Plot delta against time.true
	# dev.new(width=10, height=5)
	# par(mfrow=c(1,2))
	# plot(delta~time.true, type="n")
	time.model.of.impact=max(which(time.model==0))
	# rect(time.model.of.impact, min(delta)-100, max(time.model)+10, max(delta)+100, col = "grey")
	# points(delta~time.true, pch=24, bg="white", cex=2)
	
	### STEP 3 - Fit and compete models
	## Create a 'period' variable
	period <- ifelse(time.model==0, "Before","After")
	
	## Fit a step model
	step.Model<-aov(delta ~ period)

	## Fit a linear model
	linear.Model<-lm(delta ~ time.model)
	
	## Fit an asymptotic model
	# Create an asymptotic function
	myASYfun<-function(delta, time.model)
	{
		funAsy<-function(parS, time.model)	(parS$M * time.model) / (parS$L + time.model) + parS$B
		residFun<-function(p, observed, time.model) observed + funAsy(p,time.model)
		parStart <- list(M=mean(delta[time.model.of.impact:length(time.true)]), B=mean(delta[1:time.model.of.impact]), L=1)
		nls_ASY_out <- nls.lm(par=parStart, fn= residFun, observed=delta, time.model=time.model, control = nls.lm.control(maxfev = integer(), maxiter = 1000))
		foAsy<-delta~(M * time.model) / (L + time.model) + B
		startPar<-c(-coef(nls_ASY_out)[1], coef(nls_ASY_out)[2], coef(nls_ASY_out)[3])
		asyFit<-nls2(foAsy, start=startPar, algorithm="brute-force") # nls2 enables to calculate AICc
		asyFit
	}
	# Fit the asymptotic model
	asymptotic.Model<-myASYfun(delta=delta,time.model=time.model)
	
	
	## Fit a sigmoid model
	## Create a sigmoid function
	mySIGfun<-function(delta, time.model)
	{
		funSIG<-function(parS, time.model)	(parS$M * (time.model/parS$L)^parS$K) / (1 + (time.model/parS$L) ^ parS$K) + parS$B
		residFun<-function(p, observed, time.model) observed + funSIG(p,time.model)
		parStart <- list(M=mean(delta[time.model.of.impact:length(time.true)]), B=mean(delta[1:time.model.of.impact]), L=mean(time.model), K=5)
		nls_SIG_out <- nls.lm(par=parStart, fn= residFun, observed=delta, time.model=time.model, control = nls.lm.control(maxfev = integer(), maxiter = 1000))
		foSIG<-delta~(M * (time.model/L) ^ K) / (1 + (time.model/L) ^ K) + B
		startPar<-c(-coef(nls_SIG_out)[1],-coef(nls_SIG_out)[2],coef(nls_SIG_out)[3],coef(nls_SIG_out)[4])
		sigFit<-nls2(foSIG, start=startPar, algorithm="brute-force") # nls2 enables to calculate AICc
		sigFit
	}
	# Fit the sigmoid model
	sigmoid.Model<-mySIGfun(delta=delta,time.model=time.model)


	## Compete models
	# Perform AIC tests
	AIC.test<-AIC(step.Model, linear.Model, asymptotic.Model, sigmoid.Model)
	AICc.test<-as.data.frame(cbind(AIC.test[,1], c(AICc(step.Model), AICc(linear.Model), AICc(asymptotic.Model), AICc(sigmoid.Model))))
	rownames(AICc.test)<-rownames(AIC.test)
	names(AICc.test)<-names(AIC.test)
	
	# Calculate AICc weight and selected the best model
	for(i in 1:dim(AICc.test)[1])
	{
		AICc.test$diff[i]<-AICc.test$AIC[i]-min(AICc.test$AIC)
	}
	AICc.test$RL<-exp(-0.5* AICc.test$diff)
	RL_sum<-sum(AICc.test$RL)
	AICc.test$aicWeights<-(AICc.test$RL/RL_sum)*100
	w<-AICc.test$aicWeights
	names(w)<-rownames(AICc.test)

	# Display AICc weights
	print(w)
	# barplot(w, col="white", ylab="Relative likelihood (%)", cex.names = 0.9, names.arg =c("Step","Linear","Asymptotic","Sigmoid"))
	best.Model<-which(w==max(w))

	### STEP 4 - Derive inference based on the best model (i.e., with the higher AICc weight)
	if(best.Model==1) {writeLines(paste("\n\nSTEP MODEL SELECTED - Likelihood = ", round(w[1],1), "%\n\n", sep=""))
		print(summary(step.Model))}
	if(best.Model==2) {writeLines(paste("\n\nLINEAR MODEL SELECTED - Likelihood = ", round(w[2],1), "%\n\n", sep=""))
		print(summary(linear.Model))}
	if(best.Model==3) {writeLines(paste("\n\nASYMPTOTIC MODEL SELECTED - Likelihood = ", round(w[3],1), "%\n\n", sep=""))
		print(asymptotic.Model)}
	if(best.Model==4) {writeLines(paste("\n\nSIGMOID MODEL SELECTED - Likelihood = ", round(w[4],1), "%\n\n", sep=""))
		print(sigmoid.Model)}
}

```

Function to add a column in the frond data frame for each site called `time.model` that has the timesteps labelled the way the function wants them.

```{r}
library(rlang)

time.model.fxn <- function(site) {
  delta_fronds %>% 
    filter(site == {{ site }}) %>% 
    select(exp_dates, date, ANNUAL, CONTINUAL, CONTROL) %>% 
    # rearrange the data frame so that the "after" dates come first
    mutate(exp_dates = fct_relevel(exp_dates, c("after", "start", "during"))) %>% 
    arrange(exp_dates) %>% 
    # assign everything a "time step number" using the row numbers...
    rownames_to_column("time.model") %>% 
    # only keep the time step numbers for the "after dates"
    # make everything else 0 (i.e. everything else is before the "after")
    mutate(time.model = case_when(
      exp_dates == "start" ~ 0,
      exp_dates == "during" ~ 0,
      TRUE ~ as.numeric(as.numeric(time.model))
    )) %>% 
    # rearrage the sampling dates to be in logical order
    mutate(exp_dates = fct_relevel(exp_dates, c("start", "during", "after"))) %>% 
    arrange(exp_dates) 
}

treatment_select <- function(df, treatment_selection) {
  df %>% 
    select(date, {{ treatment_selection }}, CONTROL, time.model) %>% 
    na.omit()
}
```

### Action items
- build delta AIC for each test  
- didn't do model averaging (if you have two models with similar AIC values, how do you choose between the two?) - for each model test, want to know 1) is there a difference between before and after, and 2) what is the shape?  
- estimate rate of kelp increase per sampling period - take change in kelp biomass per time step and compare across different sites based on urchin density or sand cover?  
    - could be good to ask if some sites got kelp back at different rates - look at the quarters after, fit a shaped model (that is not just linear) - looking for rate and did it level off?  
- was there a change in eklp? can ask on average what was before or after? or somethinig fancier like progressive BACIPS?  
  - could be nice to have stat_summary: on average, how much kelp was there before and after  period (two dots with a confidence interval) - that's not going to include environmental variability that is worth including in analysis because could cloud capacity to detect effect (for example, kelp goes up and down seasonally) - before/after for two different removals average plot + timeseries of kelp with annual removal/continual removal/control + stats for BACI analysis + shape of fit that was the best fit would offer clear interpretation of what's going on at each site  
  
- could have 3 plots:
    - a. x: before/after, y: kelp biomass (3 dots with error bars and lines)  
    - b. x: time , y: absolute biomass (3 linetypes)  
    - c. x: time, y: delta  
    
- can PCBACIPS deal with random effects or multiple timeseries = would want to say, across all sites in general what happened? and say at any given site, what happened?  
  - look into any other BACI analyses that allow for site as predictor  
- label above/below line for delta plots  
- environmental variability and seasonality? 

### Mohawk

```{r}
mohk_fronds <- time.model.fxn("MOHK")

mohk_annual <- treatment_select(mohk_fronds, ANNUAL)

mohk_continual <- treatment_select(mohk_fronds, CONTINUAL)

ProgressiveChangeBACIPS(control = pull(mohk_annual, CONTROL),
                        impact = pull(mohk_annual, ANNUAL),
                        time.true = pull(mohk_annual, date),
                        time.model = pull(mohk_annual, time.model))

# STEP MODEL SELECTED - Likelihood = 52.3%

ProgressiveChangeBACIPS(control = pull(mohk_continual, CONTROL),
                        impact = pull(mohk_continual, CONTINUAL),
                        time.true = pull(mohk_continual, date),
                        time.model = pull(mohk_continual, time.model))

# LINEAR MODEL SELECTED - Likelihood = 91.7%

mohk_kelp_timeseries
```

### Arroyo Quemado

```{r}
aque_fronds <- time.model.fxn("AQUE")

aque_annual <- treatment_select(aque_fronds, ANNUAL)

aque_continual <- treatment_select(aque_fronds, CONTINUAL)

ProgressiveChangeBACIPS(control = pull(aque_annual, CONTROL),
                        impact = pull(aque_annual, ANNUAL),
                        time.true = pull(aque_annual, date),
                        time.model = pull(aque_annual, time.model))

# LINEAR MODEL SELECTED - Likelihood = 47.9%

ProgressiveChangeBACIPS(control = pull(aque_continual, CONTROL),
                        impact = pull(aque_continual, CONTINUAL),
                        time.true = pull(aque_continual, date),
                        time.model = pull(aque_continual, time.model))

# STEP MODEL SELECTED - Likelihood = 49.3%

aque_kelp_timeseries
```

### Isla Vista

```{r}
ivee_fronds <- time.model.fxn("IVEE")

ivee_annual <- treatment_select(ivee_fronds, ANNUAL)
  
ProgressiveChangeBACIPS(control = pull(ivee_annual, CONTROL),
                        impact = pull(ivee_annual, ANNUAL),
                        time.true = pull(ivee_annual, date),
                        time.model = pull(ivee_annual, time.model))

# LINEAR MODEL SELECTED - Likelihood = 52.4%

ivee_kelp_timeseries
```

### Carpinteria

```{r}
carp_fronds <- time.model.fxn("CARP")

carp_annual <- treatment_select(carp_fronds, ANNUAL)

carp_continual <- treatment_select(carp_fronds, CONTINUAL)
  
ProgressiveChangeBACIPS(control = pull(carp_annual, CONTROL),
                        impact = pull(carp_annual, ANNUAL),
                        time.true = pull(carp_annual, date),
                        time.model = pull(carp_annual, time.model))

# STEP MODEL SELECTED - Likelihood = 92.5%

ProgressiveChangeBACIPS(control = pull(carp_continual, CONTROL),
                        impact = pull(carp_continual, CONTINUAL),
                        time.true = pull(carp_continual, date),
                        time.model = pull(carp_continual, time.model))

# STEP MODEL SELECTED - Likelihood = 92.6%

carp_kelp_timeseries
```

### Naples

```{r}
napl_fronds <- time.model.fxn("NAPL")

napl_annual <- treatment_select(napl_fronds, ANNUAL)

napl_continual <- treatment_select(napl_fronds, CONTINUAL)
  
ProgressiveChangeBACIPS(control = pull(napl_annual, CONTROL),
                        impact = pull(napl_annual, ANNUAL),
                        time.true = pull(napl_annual, date),
                        time.model = pull(napl_annual, time.model))

# STEP MODEL SELECTED - Likelihood = 78.8%

ProgressiveChangeBACIPS(control = pull(napl_continual, CONTROL),
                        impact = pull(napl_continual, CONTINUAL),
                        time.true = pull(napl_continual, date),
                        time.model = pull(napl_continual, time.model))

# SIGMOID MODEL SELECTED - Likelihood = 67.7%

napl_kelp_timeseries
```

### All sites

#### test

Testing out code to get total fronds for each sampling date across sites starting with 2 sites: AQUE and NAPL. Each observation in the output should have a sampling year, total fronds in the annual, total fronds in the continual, and total fronds in the control.

```{r}
test_annual <- delta_fronds %>% 
  filter(site == "AQUE" | site == "NAPL") %>% 
  arrange(year, site) %>% 
  group_by(year, season) %>% 
  mutate(total_annual_all = sum(ANNUAL, na.rm = TRUE),
         total_continual_all = sum(CONTINUAL, na.rm = TRUE),
         total_control_all = sum(CONTROL, na.rm = TRUE)) %>% 
  ungroup() %>% 
  select(year, month, exp_dates, total_annual_all:total_control_all) %>% 
  unique() %>% 
  mutate(delta_annual_all = total_annual_all - total_control_all,
         delta_continual_all = total_continual_all - total_control_all)

ggplot(test_annual, aes(x = year)) +
  geom_line(aes(y = delta_annual_all), col = annual_col) +
  geom_point(aes(y = delta_annual_all), col = annual_col, shape = annual_shape) +
  geom_line(aes(y = delta_continual_all), col = continual_col) +
  geom_point(aes(y = delta_continual_all), col = continual_col, shape = continual_shape) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "grey") +
  theme_classic() +
  labs(x = "Year", y = "delta kelp fronds (removal - control)")

  

```



